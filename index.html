<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ultimate Mobile Code Editor</title>

<style>
/* ===== GLOBAL ===== */
*{box-sizing:border-box}
body{
  margin:0;
  background:#0e0e11;
  color:#eee;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
}
button{
  background:#1e1e26;
  color:#fff;
  border:none;
  padding:12px;
  border-radius:10px;
  font-size:16px;
}
button:active{opacity:.7}
.hidden{display:none}

/* ===== HEADER ===== */
header{
  height:52px;
  background:#15151a;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 10px;
}
header h1{
  font-size:16px;
  margin:0;
}
header .menu{
  font-size:22px;
}

/* ===== LAYOUT ===== */
#app{
  display:flex;
  height:calc(100vh - 52px);
}
#sidebar{
  width:240px;
  background:#14141c;
  border-right:1px solid #222;
  display:flex;
  flex-direction:column;
}
#main{
  flex:1;
  display:flex;
  flex-direction:column;
}

/* ===== SIDEBAR ===== */
.side-header{
  padding:10px;
  border-bottom:1px solid #222;
}
.tree{
  flex:1;
  overflow:auto;
}
.file{
  padding:10px 14px;
  border-bottom:1px solid #1f1f28;
  cursor:pointer;
}
.file.active{background:#232336}

/* ===== EDITOR ===== */
#editor-bar{
  display:flex;
  gap:6px;
  padding:6px;
  border-bottom:1px solid #222;
}
#editor{
  flex:1;
  display:flex;
}
#code{
  flex:1;
  background:#0f0f14;
  color:#f1f1f1;
  font-family:monospace;
  font-size:14px;
  padding:12px;
  outline:none;
  border:none;
  resize:none;
}

/* ===== PREVIEW ===== */
#preview{
  flex:1;
  border-top:1px solid #222;
}
iframe{
  width:100%;
  height:100%;
  border:none;
  background:#fff;
}

/* ===== MOBILE ===== */
@media(max-width:700px){
  #sidebar{position:absolute;z-index:10;height:100%}
}
</style>
</head>

<body>
<header>
  <h1>⚡ Mobile Code Editor</h1>
  <div class="menu" onclick="toggleSidebar()">☰</div>
</header>

<div id="app">
  <aside id="sidebar" class="hidden">
    <div class="side-header">
      <button onclick="newFile()">＋ New File</button>
    </div>
    <div class="tree" id="fileTree"></div>
  </aside>

  <div id="main">
    <div id="editor-bar">
      <button onclick="run()">▶ Run</button>
      <button onclick="exportHTML()">⬇ HTML</button>
      <button onclick="exportZIP()">⬇ ZIP</button>
    </div>

    <div id="editor">
      <textarea id="code" spellcheck="false"></textarea>
    </div>

    <div id="preview">
      <iframe id="frame"></iframe>
    </div>
  </div>
</div>

<script>
/* ===== STATE ===== */
let state = {
  files:{
    "index.html":"<h1>Hello World</h1>\n<script>console.log('hi')</script>"
  },
  current:"index.html"
};

/* ===== LOAD / SAVE ===== */
function save(){
  localStorage.setItem("editor_state",JSON.stringify(state));
}
function load(){
  let s = localStorage.getItem("editor_state");
  if(s) state = JSON.parse(s);
}
load();

/* ===== UI ===== */
const tree = document.getElementById("fileTree");
const code = document.getElementById("code");
const frame = document.getElementById("frame");

function renderTree(){
  tree.innerHTML="";
  Object.keys(state.files).forEach(f=>{
    let div=document.createElement("div");
    div.className="file"+(f===state.current?" active":"");
    div.textContent=f;
    div.onclick=()=>openFile(f);
    tree.appendChild(div);
  });
}

function openFile(name){
  state.current=name;
  code.value=state.files[name];
  renderTree();
  save();
}

function newFile(){
  let name=prompt("ชื่อไฟล์","");
  if(!name) return;
  state.files[name]="";
  openFile(name);
}

code.addEventListener("input",()=>{
  state.files[state.current]=code.value;
  save();
});

/* ===== RUN PREVIEW ===== */
function run(){
  frame.srcdoc = code.value;
}

/* ===== EXPORT ===== */
function exportHTML(){
  let blob=new Blob([code.value],{type:"text/html"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=state.current;
  a.click();
}

function exportZIP(){
  alert("เวอร์ชันถัดไปจะรวม zip จริง (ตัวนี้โครงพร้อม)");
}

/* ===== SIDEBAR ===== */
function toggleSidebar(){
  document.getElementById("sidebar").classList.toggle("hidden");
}

/* ===== INIT ===== */
openFile(state.current);
renderTree();
run();
</script>
</body>
</html>
